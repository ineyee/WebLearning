## 一、跨域是什么

要想知道跨域是什么，就得先知道浏览器的同源策略是什么`（注意跨域只发生在使用浏览器时，因为只有浏览器有同源策略）`

浏览器的同源策略是指两个资源的 URL 必须同时满足协议相同 + 主机 IP 地址相同 + 端口号相同，那么这两个资源才是同源的，否则这两个资源就不是同源的，而只有同源的资源才能互相访问，非同源的资源互相访问时就会发生跨域

- 协议相同，比如 `http` 和 `https`
- 主机 IP 地址相同，比如 `118.25.70.197` 和 `118.25.70.198`
- 端口号相同，比如 `80` 和 `8080`

举个会发生跨域的例子，实际开发中，前端项目打包后一般都是部署到专门的静态资源服务器上，而后端项目一般都是部署到专门的 API 服务器上，比如我们通过 http://118.25.70.197:80 请求到了前端项目的主页 index.html，进而加载到了前端项目的其它静态资源 css、js 等，而 js 代码里又请求了 http://118.25.70.197:8000/moment/getMomentList?pageSize=10&pageIndex=0 接口，那 js 代码里的这个接口请求就会报跨域问题，因为两个资源的端口号不同

```shell
Access to fetch at 'http://118.25.70.197:8000/moment/getMomentList?pageSize=10&pageIndex=0' from origin 'http://118.25.70.197:80' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.
```

## 二、为什么会产生跨域

跨域是因为浏览器的同源策略导致的，而浏览器之所以搞同源策略，是出于安全考虑`（注意跨域只发生在使用浏览器时，因为只有浏览器有同源策略）`

比如说用户通过 http://118.25.70.197:80 请求到了前端项目的主页 index.html，进而加载到了前端项目的其它静态资源 css、js 等，本来 js 代码里是要去请求我们自己服务器上 http://118.25.70.197:8000/moment/getMomentList?pageSize=10&pageIndex=0 接口的，但是黑客在 js 代码注入了一些他们的代码，转而让 js 代码去请求他们服务器上的东西去了，此时如果没有同源策略的话，js 代码是能够成功访问到黑客服务器上的东西的，比如虚假的支付页面收集用户的支付信息等，而一旦有了同源策略，就算 js 代码被注入了，js 代码访问了黑客的服务器，但肯定会报跨域问题而导致无法成功访问黑客服务器上的东西的，也就保护了用户的数据安全

当然同源策略在保护用户数据安全的同时，也导致 js 代码本来想正常访问我们自己服务器上的接口时也无法正常访问了，这是同源策略带来的副作用，但是我们只要处理一下就可以正常访问

## 三、模拟出跨域

#### 后端

开发过程中，我们一般都是通过“node ./src/main.js”或“nodemon ./src/main.js”来运行 node 项目的，其实这就是在本机启动了一个本地 koa 服务器或 express 服务器，也就是说 node 项目里接口的源就是“http:127.0.0.1:8000”，我们可以认为后端接口是部署在“http:127.0.0.1:8000”这个源的

#### 前端

开发过程中，我们一般都是通过 live server 来打开 web 原生项目的，一般都是通过“npm run serve”来打开 vue 项目的。当我们通过 live server 来打开 web 原生项目时，live server 插件其实会在本机启动一个本地服务器并监听 5500 端口，也就是说 web 原生项目的源就是“http:127.0.0.1:8000”，我们可以认为 web 原生项目是部署在“http:127.0.0.1:5500”这个源的。当我们通过“npm run serve”来打开 vue 项目时，VueCLI 会使用 webpack-dev-server 在本机启动一个本地服务器并监听 8080 端口，也就是说 vue 项目的源就是“http:127.0.0.1:8080”，我们可以认为 vue 项目是部署在“http:127.0.0.1:8080”这个源的

#### 跨域

因此开发过程中，如果 web 原生项目里或 vue 项目里访问了后端接口，那就必然会遇到跨域问题，因为它们的源不同。所以去把 server-demo 和 client-demo 都跑起来，就能看到跨域问题了

## 四、怎么解决跨域

解决跨域的常见方案：

* 方案一：把静态资源和 API 部署在同一个源下（虽然是根治，但是极少使用，都是分开部署）
* `方案二：服务端开启 CORS，支持跨域资源共享（后端开发者来解决，解决方式简单快速、前端啥也不需要干）`
* `方案三：node 代理服务器转发（前端开发者来解决，前端项目开发阶段用这个）`
* `方案四：nginx 代理服务器转发（前端开发者来解决，前端项目发布阶段用这个）`
