// ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥ http æ¨¡å—
const http = require("http");
// è§£æ url ç”¨çš„æ¨¡å—
const urlModule = require("url");

// ç¬¬äºŒæ­¥ï¼šåˆ›å»ºä¸€ä¸ª http æœåŠ¡å™¨å®ä¾‹
const httpServer = http.createServer();

// ç¬¬ä¸‰æ­¥ï¼šæŒ‡å®šè¦ç›‘å¬çš„ç«¯å£å¹¶å¯åŠ¨ http æœåŠ¡å™¨
// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¦ç›‘å¬çš„ç«¯å£ï¼ˆå³æœåŠ¡è¦éƒ¨ç½²åœ¨å“ªä¸ªç«¯å£ä¸Šï¼‰
// ç¬¬äºŒä¸ªå‚æ•°ï¼šhttp æœåŠ¡å™¨å¯åŠ¨æˆåŠŸåçš„å›è°ƒå‡½æ•°
// 
// å› ä¸ºæˆ‘ä»¬ç¼–å†™çš„è¿™ä»½ä»£ç ï¼ˆå³æœåŠ¡ï¼‰ä¼šéƒ¨ç½²åœ¨æŸä¸ªç‰¹å®šçš„æœåŠ¡å™¨ä¸Šï¼ˆå³ä¸»æœºï¼‰ï¼Œå°†æ¥å®¢æˆ·ç«¯è®¿é—®æ—¶ä¼šé€šè¿‡ IP åœ°å€æˆ–åŸŸåæ¥æ‰¾åˆ°ç›¸åº”çš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥æ˜¯ä¸éœ€è¦æŒ‡å®šä¸»æœºçš„ï¼Œåªéœ€è¦æŒ‡å®šç«¯å£å³å¯
httpServer.listen(8000, () => {
  console.log("ğŸš€æœåŠ¡å™¨å¯åŠ¨æˆåŠŸğŸš€");
});

// ç¬¬å››æ­¥ï¼šç›‘å¬æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶è¿”å›å“åº”
// ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¯·æ±‚äº‹ä»¶ï¼ˆå³å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨æ—¶ä¼šè§¦å‘è¯¥äº‹ä»¶ï¼‰
// ç¬¬äºŒä¸ªå‚æ•°ï¼šå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°ä¸­ä¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯è¯·æ±‚å¯¹è±¡ï¼ˆreqï¼‰å’Œå“åº”å¯¹è±¡ï¼ˆresï¼‰
//    è¯·æ±‚å¯¹è±¡ï¼ˆrequestï¼‰ï¼šæœ¬è´¨å°±æ˜¯ä¸€ä¸ª ReadableStreamï¼Œç”¨æ¥è¯»å–å®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚æ•°æ®ã€‚åŒ…å«äº†å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨æ—¶çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç­‰
//    å“åº”å¯¹è±¡ï¼ˆresponseï¼‰ï¼šæœ¬è´¨å°±æ˜¯ä¸€ä¸ª WritableStreamï¼Œç”¨æ¥å†™å…¥å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯ã€‚åŒ…å«äº†æœåŠ¡å™¨è¦è¿”å›ç»™å®¢æˆ·ç«¯çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚å“åº”çŠ¶æ€ç ã€å“åº”å¤´ã€å“åº”ä½“ç­‰
httpServer.on("request", (req, res) => {
  const method = req.method;
  console.log("è¯·æ±‚æ–¹æ³•ï¼š", method);

  const urlString = req.url;
  const urlObj = urlModule.parse(urlString);
  const pathName = urlObj.pathname;
  console.log("è¯·æ±‚è·¯å¾„ï¼š", pathName);

  if (pathName === "/login") {
    if (method === "POST") {
      res.statusCode = 200;
      res.end(JSON.stringify({
        "code": 200,
        "message": "ç™»å½•æˆåŠŸ",
        "data": {
          "token": "1234567890",
        },
      }));
    } else {
      res.statusCode = 405;
      res.end(JSON.stringify({
        "code": 405,
        "message": "Method Not Allowed"
      }));
    }
  } else if (pathName === "/songList") {
    if (method === "GET") {
      res.statusCode = 200;
      res.end(JSON.stringify({
        "code": 200,
        "message": "è·å–æ­Œå•æˆåŠŸ",
        "data": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
      }));
    } else {
      res.statusCode = 405;
      res.end(JSON.stringify({
        "code": 405,
        "message": "Method Not Allowed"
      }));
    }
  } else {
    res.statusCode = 404;
    res.end(JSON.stringify({
      "code": 404,
      "message": "Not Found"
    }));
  }
});

// ç¬¬äº”æ­¥ï¼šæ‰‹åŠ¨è¿è¡Œ http æœåŠ¡å™¨æµ‹è¯•çœ‹çœ‹æ•ˆæœï¼ˆå®é™…éƒ¨ç½²çš„è¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨è¿è¡Œï¼Œè€Œæ˜¯äº¤ç»™æœåŠ¡å™¨è‡ªåŠ¨è¿è¡Œï¼Œéƒ¨ç½²æµç¨‹åé¢ä¸“é—¨è¯´ï¼‰
// cd åˆ°å½“å‰æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œâ€œnode 01_åŸºæœ¬ä½¿ç”¨.jsâ€å‘½ä»¤ï¼ŒæœåŠ¡å™¨å°±è¿è¡Œèµ·æ¥äº†
// æ‰“å¼€ Postmanï¼Œè®¿é—® http://localhost:8000 æˆ– http://127.0.0.1:8000ï¼ˆå› ä¸ºæ‰‹åŠ¨è¿è¡Œæ—¶æœåŠ¡å™¨æ˜¯è·‘åœ¨æœ¬åœ°çš„ï¼Œæ‰€ä»¥è®¿é—®æ—¶æ˜¯é€šè¿‡ localhost æˆ– 127.0.0.1 æ¥è®¿é—®ï¼‰å°±å¯ä»¥äº†
// æ³¨æ„ï¼šé€šè¿‡ node æ¥æ‰‹åŠ¨è¿è¡Œï¼Œæ¯æ¬¡ä¿®æ”¹äº†æœåŠ¡å™¨çš„ä»£ç åï¼Œéƒ½éœ€è¦é‡æ–°è¿è¡ŒæœåŠ¡å™¨ï¼Œå¦åˆ™æœåŠ¡å™¨ä¸ä¼šè‡ªåŠ¨æ›´æ–°
// 
// æ‰€ä»¥ä¸ºäº†è®©æœåŠ¡å™¨èƒ½åœ¨ä¿®æ”¹ä»£ç åè‡ªåŠ¨æ›´æ–°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nodemon å·¥å…·æ¥è¿è¡ŒæœåŠ¡å™¨
// é¦–å…ˆæ‰§è¡Œå‘½ä»¤å…¨å±€å®‰è£… nodemonï¼šnpm install nodemon -g
// ç„¶åä½¿ç”¨ nodemon è¿è¡ŒæœåŠ¡å™¨ï¼šcd åˆ°å½“å‰æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œâ€œnodemon 01_åŸºæœ¬ä½¿ç”¨.jsâ€å‘½ä»¤ï¼ŒæœåŠ¡å™¨å°±è¿è¡Œèµ·æ¥äº†
