## éƒ¨ç½²

#### 1ã€è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆè¿™é‡Œä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰

###### 1.1 æ³¨å†Œé˜¿é‡Œäº‘è´¦å·
åœ¨é˜¿é‡Œäº‘å®˜ç½‘æ³¨å†Œå³å¯ï¼Œhttps://aliyun.com/

###### 1.2 è´­ä¹°äº‘æœåŠ¡å™¨
* é˜¿é‡Œäº‘é¦–é¡µ
* æ§åˆ¶å°
* æœç´¢äº‘æœåŠ¡å™¨ECSï¼Œç‚¹è¿›å»
* åˆ›å»ºå®ä¾‹ï¼ˆä¸€ä¸ªå®ä¾‹å¯¹åº”ä¸€ä¸ªæœåŠ¡å™¨ï¼‰
  * åŸºç¡€é…ç½®
    * ä»˜è´¹æ¨¡å¼ï¼šé•¿æœŸä½¿ç”¨é€‰åŒ…å¹´åŒ…æœˆï¼Œå­¦ä¹ ç»ƒä¹ é€‰æŒ‰é‡ä»˜è´¹
    * åœ°åŸŸåŠå¯ç”¨åŒºï¼šé˜¿é‡Œçš„æœåŠ¡å™¨æ”¾åœ¨å¾ˆå¤šä¸åŒçš„åœ°æ–¹ï¼Œæˆ‘ä»¬è¦é€‰æ‹©ç¦»ç”¨æˆ·è¿‘çš„é‚£ä¸ªåœ°æ–¹ä»¥ä¾¿ç”¨æˆ·è®¿é—®èµ·æ¥æ›´å¿«
    * å®ä¾‹è§„æ ¼ï¼šæœåŠ¡å™¨çš„æ ¸æ•°å’Œå†…å­˜è¦å¤šå°‘ï¼ŒæŒ‰è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç›¸åº”æ€§èƒ½çš„è§„æ ¼
    * é•œåƒæ“ä½œç³»ç»Ÿï¼šæœåŠ¡å™¨ä¸€èˆ¬å®‰è£…çš„éƒ½æ˜¯Linuxæ“ä½œç³»ç»Ÿï¼Œå…¬å¸é‡Œæˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©çš„æ˜¯Linuxæ“ä½œç³»ç»Ÿçš„CentOSç‰ˆæœ¬
    * å­˜å‚¨ï¼šæœåŠ¡å™¨çš„ç¡¬ç›˜è¦å¤šå¤§ï¼ŒæŒ‰è‡ªå·±çš„éœ€æ±‚é€‰æ‹©ç›¸åº”çš„å­˜å‚¨å®¹é‡
  * ç½‘ç»œå’Œå®‰å…¨ç»„ï¼šé€‰æ‹©é»˜è®¤çš„æˆ–ä¹‹å‰çš„å®‰å…¨ç»„æˆ–æ–°å»ºä¸€ä¸ªå®‰å…¨ç»„éƒ½è¡Œï¼Œä¸»è¦å†³å®šäº†å“ªäº›ç«¯å£å·å¯ä»¥è¢«è®¿é—®ï¼Œæ¯”å¦‚å®‰å…¨ç»„è¦æ·»åŠ ä¸Š80ç«¯å£å’Œ443ç«¯å£ï¼Œå› ä¸ºhttpè¯·æ±‚é»˜è®¤æ˜¯80ç«¯å£ï¼Œhttpsè¯·æ±‚é»˜è®¤æ˜¯443ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ·»åŠ ä¸Šè¿™ä¸¤ä¸ªç«¯å£ï¼Œè¿™æ ·æˆ‘ä»¬çš„æœåŠ¡å™¨æ‰èƒ½è¢«å¤–ç½‘è®¿é—®ï¼Œåˆæ¯”å¦‚MySQLæ•°æ®åº“é»˜è®¤çš„ç«¯å£æ˜¯3306ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿè¦æ·»åŠ ä¸Šè¿™ä¸ªç«¯å£ï¼Œå¦åˆ™æˆ‘ä»¬çš„æ•°æ®åº“ä¹Ÿä¸èƒ½è¢«å¤–ç½‘è®¿é—®
  * å¯†é’¥å¯¹æˆ–å¯†ç ï¼šé€‰æ‹©è‡ªå®šä¹‰å¯†ç ï¼Œè¾“å…¥å¯†ç ï¼Œå°±æ˜¯rootè¿™ä¸ªç”¨æˆ·çš„å¯†ç ï¼Œå°†æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªè´¦å·å’Œå¯†ç æ¥è®¿é—®æœåŠ¡å™¨
  
#### 2ã€é…ç½®äº‘æœåŠ¡å™¨ï¼Œç»™æœåŠ¡å™¨å®‰è£…nodeå’Œmysql

###### 2.1 å…ˆæŠŠæˆ‘ä»¬çš„ç”µè„‘è¿æ¥åˆ°æœåŠ¡å™¨
* é˜¿é‡Œäº‘çš„å®ä¾‹ï¼ˆå³æœåŠ¡å™¨ï¼‰è¯¦æƒ…é¡µé¢é‡Œæœ‰ä¸ªâ€œè¿œç¨‹è¿æ¥â€ï¼Œç‚¹å‡»å®ƒå³å¯è¿æ¥ä¸ŠæœåŠ¡å™¨

###### 2.2 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œç»™æœåŠ¡å™¨å®‰è£…nodeå’Œmysql
* æ‰§è¡Œâ€œdnf install nodejsâ€å‘½ä»¤å®‰è£…nodejsï¼ˆå»ºè®®æœåŠ¡å™¨ä¸Šçš„ node ç‰ˆæœ¬è·Ÿæœ¬æœº node ç‰ˆæœ¬ä¸€è‡´ï¼Œä¸ç„¶å®¹æ˜“æœ¬åœ°é¡¹ç›®èƒ½è·‘å»æ¥ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸Šçš„é¡¹ç›®è·‘ä¸èµ·æ¥ï¼‰
* å¯ä»¥é€šè¿‡â€œnode -vâ€æˆ–â€œnode --versionâ€æ¥æŸ¥çœ‹æ‰€å®‰è£…nodejsçš„ç‰ˆæœ¬
* æ‰§è¡Œâ€œdnf install mysql-serverâ€å‘½ä»¤å®‰è£…mysql
* å¯ä»¥é€šè¿‡â€œmysql -Vâ€æˆ–â€œmysql --versionâ€æ¥æŸ¥çœ‹æ‰€å®‰è£…mysqlçš„ç‰ˆæœ¬

###### 2.3 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œå¯åŠ¨mysql
* æ‰§è¡Œâ€œsystemctl start mysqldâ€å‘½ä»¤æ¥å¯åŠ¨mysql
* ç„¶åæˆ‘ä»¬å¯ä»¥æ‰§è¡Œâ€systemctl status mysqldâ€œå‘½ä»¤æ¥æŸ¥çœ‹mysqlçš„è¿è¡ŒçŠ¶æ€æ˜¯å¦æˆåŠŸå¯åŠ¨ï¼Œå¦‚æœçœ‹åˆ°active(running)å°±ä»£è¡¨å¯åŠ¨æˆåŠŸäº†
* æ­¤å¤–æˆ‘ä»¬è¿˜å¯ä»¥æ‰§è¡Œâ€systemctl enable mysqldâ€œå‘½ä»¤æ¥è®©æœåŠ¡å™¨é‡å¯æ—¶è‡ªåŠ¨å¯åŠ¨mysqlï¼Œå…å¾—æ¯æ¬¡é‡å¯ç³»ç»Ÿè¿˜å¾—æˆ‘ä»¬ä¸»åŠ¨æ‰§è¡Œå‘½ä»¤æ¥å¯åŠ¨mysql

###### 2.4 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œé…ç½®mysql
æ‰§è¡Œâ€œmysql_secure_installationâ€å‘½ä»¤æ¥é…ç½®mysql
* é€‰æ‹© yes æ¥å¼€æ˜¯é…ç½®
* é€‰æ‹©ç»™æ•°æ®åº“è®¾ç½®å¼ºå¯†ç 
* è®¾ç½®æ•°æ®åº“çš„å¯†ç ï¼Œè®°ä¸‹è¿™ä¸ªå¯†ç ï¼Œå°†æ¥æˆ‘ä»¬åœ¨ä»£ç é‡Œè¿æ¥æ•°æ®åº“æ—¶è¦ç”¨åˆ°
* é€‰æ‹© yes æ¥ç¡®è®¤ä½¿ç”¨æ­¤å¯†ç 
* ç„¶åä¼šè®©æˆ‘ä»¬é€‰æ‹©æ˜¯å¦åˆ é™¤åŒ¿åç”¨æˆ·ï¼Œæˆ‘ä»¬é€‰æ‹©Y
* ç„¶åä¼šè®©æˆ‘ä»¬é€‰æ‹©æ˜¯å¦ç¦æ­¢rootç”¨æˆ·è¿œç¨‹ç™»å½•ï¼Œæˆ‘ä»¬é€‰æ‹©N
* ç„¶åä¼šè®©æˆ‘ä»¬é€‰æ‹©æ˜¯å¦åˆ é™¤testæ•°æ®åº“ï¼Œæˆ‘ä»¬é€‰æ‹©Y
* ç„¶åä¼šè®©æˆ‘ä»¬é€‰æ‹©æ˜¯å¦åˆ·æ–°æƒé™è¡¨ï¼Œæˆ‘ä»¬é€‰æ‹©Y

###### 2.5 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œä¿®æ”¹æ•°æ®åº“ root ç”¨æˆ·çš„è®¿é—®æƒé™
* æ‰§è¡Œâ€œmysql -u root -pâ€å‘½ä»¤æ¥ç™»å½•æ•°æ®åº“ï¼Œå›è½¦åä¼šæç¤ºæˆ‘ä»¬è¾“å…¥å¯†ç ï¼Œè¾“å…¥å‰é¢æˆ‘ä»¬ç»™æ•°æ®åº“è®¾ç½®çš„å¯†ç å³å¯
* ç™»å½•æˆåŠŸåï¼Œæ‰§è¡Œâ€œuse mysql;â€å‘½ä»¤æ¥åˆ‡æ¢åˆ°mysqlæ•°æ®åº“
* æ‰§è¡Œâ€œselect host, user from user;â€å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„ç”¨æˆ·åˆ—è¡¨ï¼Œé»˜è®¤å¦‚ä¸‹ï¼š
```
+-----------+------------------+
| host      | user             |
+-----------+------------------+
| localhost | mysql.infoschema |
| localhost | mysql.session    |
| localhost | mysql.sys        |
| localhost | root             |
+-----------+------------------+
```
* å¯ä»¥çœ‹åˆ°æœ‰ä¸€è¡Œè®°å½•æ˜¯è¿™æ ·çš„ï¼šâ€œlocalhost rootâ€ï¼Œè¿™ä»£è¡¨rootç”¨æˆ·åªèƒ½åœ¨å½“å‰æœåŠ¡å™¨ä¸Šæ¥è®¿é—®æ•°æ®åº“ï¼Œæ— æ³•é€šè¿‡å…¶å®ƒä¸»æœºè®¿é—®æ•°æ®åº“ï¼Œå¯æ˜¯æˆ‘ä»¬éœ€è¦å„ä¸ªå¼€å‘è€…é€šè¿‡ä»–ä»¬ç”µè„‘ä¸ŠNavicatæ¥è®¿é—®æ•°æ®åº“ï¼Œæ‰€ä»¥å¾—æŠŠæŠŠâ€œlocalhostâ€æ”¹æˆâ€œ%â€ï¼ˆé€šé…ç¬¦ï¼‰ï¼Œè¿™æ ·rootç”¨æˆ·å¯ä»¥ä»ä»»æ„ä¸»æœºç™»å½•äº†
* æ‰§è¡Œâ€œupdate user set host='%' where user='root';â€å‘½ä»¤æ¥ä¿®æ”¹rootç”¨æˆ·çš„è®¿é—®æƒé™ 
* å†æ¬¡æ‰§è¡Œâ€œselect host, user from user;â€å‘½ä»¤æ¥å†æ¬¡æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œå‘ç°å·²ç»æ›´æ–°æˆåŠŸï¼š
```
+-----------+------------------+
| host      | user             |
+-----------+------------------+
| localhost | mysql.infoschema |
| localhost | mysql.session    |
| localhost | mysql.sys        |
| %         | root             |
+-----------+------------------+
```
* æ‰§è¡Œâ€œflush privileges;â€å‘½ä»¤æ¥åˆ·æ–°æƒé™è¡¨ï¼Œè¿™æ ·ä¿®æ”¹æ‰ä¼šç”Ÿæ•ˆ
* æ‰§è¡Œâ€œexit;â€å‘½ä»¤æ¥é€€å‡ºæ•°æ®åº“

#### 3ã€åœ¨ Navicat GUI å·¥å…·é‡Œè¿æ¥æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“
* é¦–å…ˆå¾—ç¡®ä¿ç½‘ç»œå’Œå®‰å…¨ç»„é‡Œæ·»åŠ äº†3306ç«¯å£ï¼Œå¦åˆ™è¿æ¥ä¸ä¸Š
* å…¶æ¬¡å¾—åšå¥½2.5 rootç”¨æˆ·çš„è®¿é—®æƒé™ï¼Œå¦åˆ™è¿æ¥ä¸äº†
* ç„¶åå°±å¯ä»¥å»Navicaté‡Œè¿æ¥æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“äº†
  * æ–°å»ºä¸€ä¸ªè¿æ¥
  * è¿æ¥çš„ç±»å‹é€‰æ‹©ä¸º MySQL
  * è¾“å…¥è¿æ¥çš„åå­—ï¼Œå¦‚ali_mysql
  * è¾“å…¥åŸŸåå’Œç«¯å£å·ï¼Œå¦‚118.25.70.197ã€3306
  * è¾“å…¥è´¦å·å’Œå¯†ç ï¼Œrootã€å‰é¢æˆ‘ä»¬è®¾ç½®çš„æ•°æ®åº“å¯†ç 
  * ç¡®å®šåè¿æ¥å°±åˆ›å»ºå¥½äº†ï¼Œæ­¤æ—¶è¿æ¥æ˜¯ç°è‰²ï¼Œä»£è¡¨è¿æ¥å°šæœªå¯åŠ¨
  * åŒå‡»è¿™ä¸ªè¿æ¥å°±å¯ä»¥å¯åŠ¨äº†ï¼Œæ­¤æ—¶è¿æ¥ä¼šå˜æˆç»¿è‰²ï¼Œè¿™ä¸ªè¿æ¥ä¸‹æ‰€æœ‰çš„æ•°æ®åº“ä¹Ÿä¼šè¢«å±•ç¤ºå‡ºæ¥
* è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨Navicaté‡Œæ“ä½œæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“äº†ï¼Œæ¯”å¦‚åˆ›å»ºè¡¨ã€æŸ¥çœ‹è¡¨é‡Œçš„æ•°æ®ç­‰ç­‰

#### 4ã€åœ¨ Navicat GUI å·¥å…·é‡Œåšæ•°æ®åº“è¿ç§»
æ¯”å¦‚é¡¹ç›®åˆšå¼€å§‹æˆ‘ä»¬çš„æ•°æ®åº“æ˜¯åˆ›å»ºåœ¨è‡ªå·±ç”µè„‘ä¸Šçš„ä¸€ä¸ªæ•°æ®åº“ï¼Œç°åœ¨é¡¹ç›®å¼€å‘å®Œäº†ï¼Œæœ¬åœ°æ•°æ®åº“é‡Œå·²ç»æœ‰å„ç§è¡¨ç»“æ„åŠå…³è¿äº†ï¼Œå½“ç„¶ä¹Ÿæœ‰ä¸€äº›æµ‹è¯•æ•°æ®ï¼Œç°åœ¨è¦æŠŠæœ¬åœ°è¿™ä¸ªæ•°æ®åº“è¿ç§»åˆ°æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“é‡Œï¼Œè¿™ä»¶äº‹æƒ…å…¶å®å¾ˆç®€å•ï¼ŒNavicat GUI å·¥å…·å°±å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆ
* é€‰ä¸­æœ¬åœ°çš„æ•°æ®åº“
* å³é”®é€‰ä¸­â€œè½¬å‚¨ SQL æ–‡ä»¶â€ï¼Œé€‰æ‹©â€œç»“æ„å’Œæ•°æ®â€ï¼ˆè¡¨ç»“æ„å’Œæµ‹è¯•æ•°æ®ï¼‰æˆ–â€œä»…ç»“æ„â€ï¼ˆä»…è¡¨ç»“æ„ï¼‰ï¼Œå¼€å§‹è½¬å‚¨ï¼Œç­‰å¾…ä¸‹è½½å®Œæˆ
* åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªè·Ÿæœ¬åœ°åŒåçš„æ•°æ®åº“
* ç„¶åç›´æ¥æŠŠä¸‹è½½å¥½çš„ SQL æ–‡ä»¶ç›´æ¥æ‹–åˆ°è¿œç¨‹æ•°æ®åº“é‡Œï¼Œæ ¹æ®æç¤ºè¿è¡Œä¸€ä¸‹å³å¯ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒæœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“å°±è·Ÿæœ¬åœ°çš„ä¸€æ¨¡ä¸€æ ·äº†

#### 5ã€æŠŠæˆ‘ä»¬çš„é¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨

> `é¦–å…ˆç¡®ä¿æˆ‘ä»¬é¡¹ç›®é‡Œçš„IPåœ°å€æ˜¯äº‘æœåŠ¡å™¨çš„å…¬ç½‘IPåœ°å€ï¼Œå¦åˆ™æ¥å£è¯·æ±‚ä¸é€š`
>
> `å…¶æ¬¡ç¡®ä¿æˆ‘ä»¬é¡¹ç›®é‡Œçš„ç«¯å£å·åœ¨äº‘æœåŠ¡å™¨çš„ç½‘ç»œä¸å®‰å…¨ç»„é‡Œæ·»åŠ äº†ï¼Œå¦åˆ™æ¥å£è¯·æ±‚ä¸é€š`
>
> `æœ€åç¡®ä¿æ•°æ®åº“é…ç½®é‡Œçš„å‚æ•°éƒ½æ˜¯è¿œç¨‹æœåŠ¡å™¨çš„å‚æ•°ï¼Œå¦åˆ™æ¥å£è¯·æ±‚ä¸é€š`
>
> `æ— è®ºæ‰‹åŠ¨éƒ¨ç½²è¿˜æ˜¯è‡ªåŠ¨éƒ¨ç½²ï¼Œå»ºè®®ç¬¬ä¸€æ¬¡éƒ¨ç½²æ—¶é‡‡ç”¨æ‰‹åŠ¨éƒ¨ç½²ï¼Œå› ä¸ºæ‰‹åŠ¨éƒ¨ç½²çš„ç¬¬ä¸€æ¬¡éƒ¨ç½²å¿…ç„¶æ˜¯æ‰‹åŠ¨éƒ¨ç½²ï¼Œè€Œè‡ªåŠ¨éƒ¨ç½²çš„ç¬¬ä¸€æ¬¡é‡‡ç”¨æ‰‹åŠ¨éƒ¨ç½²ä¹Ÿå¯ä»¥é¿å…åç»­è‡ªåŠ¨éƒ¨ç½²æ—¶jenkinsæŠ¥å„ç§æ–‡ä»¶å¤¹å’Œæ–‡ä»¶æ— æ³•åˆ›å»ºçš„é—®é¢˜`

###### 5.1 æ‰‹åŠ¨éƒ¨ç½²
* VSCodeé‡Œå®‰è£…â€Remote -SSHâ€œæ’ä»¶ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥åœ¨é˜¿é‡Œäº‘çš„é‚£ä¸ªè¿æ¥è¿œç¨‹é‡Œåšï¼Œé‚£ä¸ªé‡Œé¢ä¹Ÿèƒ½æ‰“å¼€æ–‡ä»¶å¤¹ï¼‰
* å·¦ä¾§ä¾§è¾¹æ é€‰ä¸­è¯¥æ’ä»¶
* SSHå³ä¾§é€‰æ‹©æ–°å»ºè¿œç¨‹
* åœ¨å¼¹çª—é‡Œè¾“å…¥â€œssh root@æœåŠ¡å™¨çš„å…¬ç½‘IPâ€ï¼Œå›è½¦æ¥æ–°å»ºè¿œç¨‹
* é€‰æ‹©â€œ/User/xxx/.ssh/configâ€é…ç½®æ–‡ä»¶
* å·¦ä¾§SSHä¸‹å°±æœ‰æˆ‘ä»¬çš„è¿œç¨‹æœåŠ¡å™¨äº†
* é€‰ä¸­è¿œç¨‹æœåŠ¡å™¨ï¼Œå³é”®è¿æ¥ï¼Œè¾“å…¥rootç”¨æˆ·çš„å¯†ç å³å¯å‘èµ·è¿æ¥
* è¿æ¥æˆåŠŸåï¼Œé€‰ä¸­å·¦ä¾§ä¾§è¾¹æ çš„æ–‡ä»¶ï¼Œå‘ç°é‡Œé¢ä¼šæç¤ºâ€œå·²è¿æ¥åˆ°è¿œç¨‹â€
* ç„¶åæˆ‘ä»¬é€‰æ‹©â€œæ‰“å¼€æ–‡ä»¶å¤¹â€æ¥æ‰“å¼€è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¤¹ï¼Œé»˜è®¤ä¼šå¸®æˆ‘ä»¬æ‰“å¼€è¿œç¨‹æœåŠ¡å™¨çš„rootæ–‡ä»¶å¤¹ï¼Œè¿™æ ·è¿œç¨‹æœåŠ¡å™¨çš„rootæ–‡ä»¶å¤¹å°±å±•ç¤ºåœ¨VSCodeé‡Œäº†
* ç›´æ¥æŠŠæˆ‘ä»¬çš„é¡¹ç›®æ‹–è¿›rootæ–‡ä»¶å¤¹é‡Œï¼Œè¿™æ ·è¿œç¨‹æœåŠ¡å™¨ä¸Šå°±æœ‰æˆ‘ä»¬çš„é¡¹ç›®äº†
* æ‰“å¼€ç»ˆç«¯ï¼Œæ­¤æ—¶çš„ç»ˆç«¯é»˜è®¤å°±æ˜¯æ“ä½œè¿œç¨‹æœåŠ¡å™¨
* cd åˆ°æœåŠ¡å™¨ä¸Šæˆ‘ä»¬é‚£ä»½é¡¹ç›®çš„æ ¹ç›®å½•
  * æ‰§è¡Œâ€œnpm installâ€æ¥å®‰è£…é¡¹ç›®ä¾èµ–çš„ä¸‰æ–¹åº“ï¼ˆå› ä¸ºæˆ‘ä»¬å¯èƒ½ gitignore äº†ä¸‰æ–¹åº“çš„æºæ–‡ä»¶ï¼‰ï¼Œè¦æŠŠè¿™äº›ä¸‰æ–¹åº“å®‰è£…åˆ°æœåŠ¡å™¨ä¸Šï¼Œå°±åƒæˆ‘ä»¬æœ¬æœºç”µè„‘ä¸Šæœ‰è¿™äº›ä¸‰æ–¹åº“ä¸€æ ·
  * æ‰§è¡Œâ€œpm2 start ./src/main.js --name coder-hub-fullâ€æ¥å¯åŠ¨é¡¹ç›®
* å»è¯·æ±‚æ¥å£è¯•è¯•å§

## é™„å½•ï¼špm2 å·¥å…·

æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ç»ˆç«¯ä½¿ç”¨â€œnode|nodemon æˆ‘ä»¬é¡¹ç›®çš„å…¥å£æ–‡ä»¶â€æˆ–â€œnpm run startâ€ä¹‹ç±»çš„å‘½ä»¤æ¥å¯åŠ¨é¡¹ç›®ï¼Œä½†æ˜¯è¿™æ ·å¯åŠ¨çš„é¡¹ç›®ä¼šåœ¨æˆ‘ä»¬ç»ˆç«¯å…³é—­åå°±åœæ­¢è¿è¡Œï¼Œç”¨æˆ·å°±æ— æ³•ç»§ç»­è®¿é—®æˆ‘ä»¬çš„é¡¹ç›®äº†ï¼Œæ‰€ä»¥å®é™…å¼€å‘ä¸­æˆ‘ä»¬éƒ½æ˜¯ç”¨ pm2ï¼ˆprocess managerï¼‰ æ¥ç®¡ç†æˆ‘ä»¬é¡¹ç›®è¿›ç¨‹çš„å¯åŠ¨ä¸åœæ­¢ï¼Œå®ƒå°±ä¼šç¡®ä¿ç»ˆç«¯å…³é—­åé¡¹ç›®è¿˜ä¸€ç›´åœ¨æœåŠ¡å™¨ä¸Šè·‘

åœ¨ç»ˆç«¯é‡Œå…¨å±€å®‰è£… pm2ï¼š

```shell
npm install pm2 -g
```

pm2 å¸¸ç”¨çš„å‘½ä»¤ï¼š

```shell
# æŸ¥çœ‹ pm2 çš„å®‰è£…ç‰ˆæœ¬
pm2 -v
pm2 --version

# å¯åŠ¨è¿›ç¨‹å¹¶ç»™è¿›ç¨‹èµ·ä¸ªåå­—
pm2 start é¡¹ç›®å…¥å£æ–‡ä»¶ --name è¿›ç¨‹çš„åå­—

# æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çŠ¶æ€
pm2 list

# åœæ­¢æŒ‡å®šçš„è¿›ç¨‹ï¼ˆè¿›ç¨‹åœæ­¢ï¼Œä½†æ˜¯è¿˜ä¼šå­˜å‚¨åœ¨ list é‡Œï¼‰
pm2 stop è¿›ç¨‹çš„ id
# åœæ­¢æ‰€æœ‰è¿›ç¨‹ï¼ˆè¿›ç¨‹åœæ­¢ï¼Œä½†æ˜¯è¿˜ä¼šå­˜å‚¨åœ¨ list é‡Œï¼‰
pm2 stop all

# é‡å¯æŒ‡å®šçš„è¿›ç¨‹
pm2 restart è¿›ç¨‹çš„ id
# é‡å¯æ‰€æœ‰è¿›ç¨‹
pm2 restart all

# æ€æ­»æŒ‡å®šçš„è¿›ç¨‹ï¼ˆè¿›ç¨‹æ€æ­»ï¼Œä¸ä¼šå­˜å‚¨åœ¨ list é‡Œï¼‰
pm2 delete è¿›ç¨‹çš„ id
# æ€æ­»å…¨éƒ¨è¿›ç¨‹ï¼ˆè¿›ç¨‹æ€æ­»ï¼Œä¸ä¼šå­˜å‚¨åœ¨ list é‡Œï¼‰
pm2 delete all

# æˆ‘ä»¬çš„é¡¹ç›®åŒæ—¶è·‘å‡ ä¸ªè¿›ç¨‹ï¼Œä»¥ä¾¿é«˜å¹¶å‘æ—¶å®ç°è´Ÿè½½å‡è¡¡
pm2 start é¡¹ç›®å…¥å£æ–‡ä»¶ -i å‡ ä¸ªè¿›ç¨‹ --name æ‰€æœ‰è¿›ç¨‹çš„åå­—
```

###### 3.2 Jenkinsè‡ªåŠ¨éƒ¨ç½²

###### 3.2.1 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œç»™æœåŠ¡å™¨å®‰è£…Javaç¯å¢ƒ

Jenkinsæœ¬èº«æ˜¯ä¾èµ–Javaçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå®‰è£…Javaç¯å¢ƒï¼š

* æ‰§è¡Œâ€œdnf search javaâ€å‘½ä»¤æ¥æŸ¥çœ‹æ”¯æŒçš„javaç‰ˆæœ¬ï¼Œé€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬æ¯”å¦‚â€œjava-21-openjdkâ€
* æ‰§è¡Œâ€œdnf install java-21-openjdkâ€å‘½ä»¤å®‰è£…java
* å¯ä»¥é€šè¿‡â€œjava --versionâ€æ¥æŸ¥çœ‹æ‰€å®‰è£…javaçš„ç‰ˆæœ¬

###### 3.2.2 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œç»™æœåŠ¡å™¨å®‰è£…JenkinsåŠå…¶æ’ä»¶

å› ä¸ºJenkinsæœ¬èº«æ˜¯æ²¡æœ‰åœ¨dnfçš„è½¯ä»¶ä»“åº“åŒ…ä¸­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡Jenkinsä»“åº“æ¥å®‰è£…ï¼š

* wgetæ˜¯Linuxä¸­ä¸‹è½½æ–‡ä»¶çš„ä¸€ä¸ªå·¥å…·ï¼Œ-Oè¡¨ç¤ºè¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶å¤¹å¹¶ä¸”å‘½åä¸ºä»€ä¹ˆæ–‡ä»¶
* rpmï¼šæ˜¯Linuxä¸‹ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å™¨

```shell
# æŠŠJenkinsä»“åº“æ–‡ä»¶å…ˆä¸‹è½½åˆ°æœåŠ¡å™¨çš„æŸä¸ªç›®å½•ä¸‹
wget â€“O /etc/yum.repos.d/jenkins.repo http://pkg.jenkins-ci.org/redhat-stable/jenkins.repo

# å¯¼å…¥GPGå¯†é’¥ä»¥ç¡®ä¿å®‰è£…çš„jenkinsè½¯ä»¶åˆæ³•
sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
# æˆ–è€…
rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key
```

ç›´æ¥æ‰¾åˆ°â€œ/etc/yum.repos.d/jenkins.repoâ€è¿™ä¸ªä»“åº“æ–‡ä»¶æˆ–é€šè¿‡â€œvim /etc/yum.repos.d/jenkins.repoâ€æŠŠä¸‹é¢çš„å†…å®¹å¤åˆ¶è¿›ä»“åº“æ–‡ä»¶é‡Œ

```
[jenkins]

name=Jenkins-stable

baseurl=http://pkg.jenkins.io/redhat

gpgcheck=1
```

å®‰è£…Jenkins

```shell
dnf install jenkins # --nogpgcheck(å¯ä»¥ä¸åŠ )
```

å¯åŠ¨Jenkinsçš„æœåŠ¡ï¼š

```shell
systemctl start jenkins
systemctl status jenkins
systemctl enable jenkins
```

å› ä¸ºJenkinsé»˜è®¤ä½¿ç”¨æœåŠ¡å™¨çš„8080ç«¯å£æä¾›æœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦åœ¨äº‘æœåŠ¡å™¨çš„ç½‘ç»œå’Œå®‰å…¨ç»„é‡Œæ·»åŠ 8080ç«¯å£ã€‚æ·»åŠ å¥½ç«¯å£åï¼Œæ­¤æ—¶å»æµè§ˆå™¨é‡Œé€šè¿‡äº‘æœåŠ¡å™¨çš„ipåœ°å€åŠ ç«¯å£å·å°±èƒ½è®¿é—®åˆ°jenkinsçš„æœåŠ¡äº†ï¼Œæ¯”å¦‚ï¼šhttp://118.25.70.197:8080

è®¿é—®åœ°å€åï¼ŒJenkinsä¼šæç¤ºæˆ‘ä»¬ç™»å½•ï¼Œå¹¶ä¸”å‘Šè¯‰æˆ‘ä»¬adminç”¨æˆ·çš„åˆå§‹å¯†ç å­˜å‚¨åœ¨äº‘æœåŠ¡å™¨ä¸Šçš„å“ªä¸ªæ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶æ‹¿åˆ°å¯†ç ï¼Œæˆ–è€…é€šè¿‡ä¸‹é¢çš„catå‘½ä»¤ç›´æ¥è¯»å–æ–‡ä»¶æ‹¿åˆ°å¯†ç ï¼Œç„¶åç™»å½•è¿›å»ï¼š

```shell
cat /var/lib/jenkins/secrets/initialAdminPassword # è¯»å–æ–‡ä»¶é‡Œçš„å¯†ç 
```

ç™»å½•æˆåŠŸåé€‰æ‹©â€œå®‰è£…æ¨èçš„æ’ä»¶â€ï¼Œè¿™æ ·ä¸€æ¥jenkinsåœ¨æ‰§è¡Œå¤§å¤šæ•°æ“ä½œæ—¶æ‰€éœ€è¦çš„æ’ä»¶å°±è¢«å®‰è£…å¥½äº†

å½“ç„¶ä¹Ÿæœ‰ä¸€äº›æ’ä»¶éœ€è¦æˆ‘ä»¬åç»­æ‰‹åŠ¨å®‰è£…â€”â€”æ¯”å¦‚nodeï¼Œä¸€ä¼šè¿›å»ä¹‹åè®°å¾—æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹nodeæ’ä»¶ï¼šã€ç®¡ç†jenkinsã€‘-ã€æ’ä»¶ã€‘-ã€å¯ç”¨çš„æ’ä»¶ã€‘-ã€æœç´¢nodeã€‘-ã€å®‰è£…nodejsã€‘ã€‚å®‰è£…å¥½nodejsæ’ä»¶ä¹‹åï¼Œè¿˜å¾—å»ã€å…¨å±€å·¥å…·é…ç½®ã€‘-ã€NodeJS å®‰è£…ã€‘-ã€æ–°å¢NodeJSã€‘-ã€åˆ«åéšä¾¿å–ä¸€ä¸ªæ¯”å¦‚å«nodeã€‘-ã€è¦å®‰è£…çš„nodeç‰ˆæœ¬å·æœ€å¥½è·Ÿä½ ç”µè„‘ä¸Šå¼€å‘ç”¨çš„é‚£ä¸ªç‰ˆæœ¬å·ä¸€è‡´ï¼Œä¸ç„¶å¯èƒ½å› ä¸ºapiä¸ä¸€è‡´ï¼Œæœ¬åœ°ä»£ç èƒ½è·‘æœåŠ¡å™¨ä¸Šå°±ä¸èƒ½è·‘äº†ã€‘-ã€å…¶ä»–çš„ä¸ç”¨ç®¡ã€‘-ã€ä¿å­˜ã€‘ï¼ˆè¿™é‡Œå…¶å®æ˜¯è®©jenkins ç»™æœåŠ¡å™¨å®‰è£…ä¸€ä¸ªnodeï¼Œå¦‚æœæˆ‘ä»¬æœåŠ¡å™¨ä¸Šå·²ç»å®‰è£…ç›¸åŒç‰ˆæœ¬çš„è¯å°±ä¸ç”¨å®‰è£…äº†ï¼‰

æ’ä»¶å®‰è£…æˆåŠŸåï¼Œjenkinsä¼šæç¤ºæˆ‘ä»¬åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ä»¥ä¾¿åç»­ä½¿ç”¨ï¼Œå› ä¸ºåˆšæ‰é»˜è®¤çš„adminç”¨æˆ·å¯†ç å¤ªéš¾è®°äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯ç”¨è‡ªå·±åˆ›å»ºçš„ç”¨æˆ·æ¥ä½¿ç”¨jenkinsï¼ŒæŒ‰æç¤ºåˆ›å»ºç”¨æˆ·å¹¶ç™»å½•è¿›å»å³å¯

###### 3.2.3 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œé…ç½®jenkins

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è®©jenkinså…·å¤‡rootæƒé™ï¼Œåˆ°æ—¶å€™jenkinsè®¿é—®æˆ‘ä»¬æœåŠ¡å™¨ä¸Šçš„èµ„æºæ—¶å°±æ˜¯ä»¥rootæƒé™è®¿é—®äº†ï¼Œæ‰§è¡Œå®Œåè®°å¾—é‡å¯ä¸€ä¸‹jenkins

```shell
sudo usermod -a -G root jenkins
systemctl restart jenkins
```

å¦‚æœæ‰§è¡Œäº†ä¸Šé¢çš„å‘½ä»¤ï¼Œåœ¨æ‰“åŒ…æ—¶è¿˜æ˜¯é‡åˆ°æ— æ³•åˆ é™¤åŸé¡¹ç›®çš„æƒé™é—®é¢˜ï¼Œå¯ä»¥å†æ‰§è¡Œä¸‹ä¸‹é¢çš„å‘½ä»¤ï¼Œæ‰§è¡Œå®Œåè®°å¾—é‡å¯ä¸€ä¸‹jenkins

```shell
sudo chown -R jenkins /root/coder-hub-full #æ›¿æ¢æˆé¡¹ç›®çš„çœŸå®ç›®å½•
systemctl restart jenkins
```

###### 3.2.4 åœ¨é˜¿é‡Œäº‘ç»™æˆ‘ä»¬æ‰“å¼€çš„ç»ˆç«¯é‡Œç»™æœåŠ¡å™¨å®‰è£…git
å› ä¸ºå°†æ¥jenkinsè¦é€šè¿‡gitæ¥æ‹‰å–æˆ‘ä»¬æäº¤çš„ä»£ç åˆ°æœåŠ¡å™¨ä¸Š
* æ‰§è¡Œâ€œdnf install gitâ€å‘½ä»¤å®‰è£…git
* å¯ä»¥é€šè¿‡â€œgit -vâ€æˆ–â€œgit --versionâ€æ¥æŸ¥çœ‹æ‰€å®‰è£…nginxçš„ç‰ˆæœ¬

###### 3.2.5 æ–°å»ºæ‰“åŒ…ä»»åŠ¡ã€å®Œæˆè‡ªåŠ¨æ‰“åŒ…ä¸éƒ¨ç½²

* `æ–°å»ºä»»åŠ¡`

æ–°å»º item å’Œ create a job æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æ–°å»ºä¸€ä¸ªä»»åŠ¡

![alt text](./jenkins-img/1.png)

è¾“å…¥ä»»åŠ¡åã€é€‰æ‹©è‡ªå®šä¹‰æ‰“åŒ…æµç¨‹ã€ç‚¹å‡»ç¡®å®š

![alt text](./jenkins-img/2.png)

* `General -> å‚æ•°åŒ–æ„å»ºè¿‡ç¨‹ -> æ·»åŠ å‚æ•°`

![alt text](./jenkins-img/3.png)

![alt text](./jenkins-img/4.png)

![alt text](./jenkins-img/4_1.png)

![alt text](./jenkins-img/4_2.png)

* `æºç ç®¡ç†`

å…ˆåˆ›å»ºä¸€ä¸ªå‡­æ®ï¼šã€ç®¡ç†jenkinsã€‘-ã€å‡­æ®ç®¡ç†ã€‘-ã€Systemã€‘-ã€å…¨å±€å‡­æ®ã€‘-ã€æ·»åŠ å‡­æ®ã€‘- è¾“å…¥ä½ gitä»“åº“çš„è´¦å·å’Œå¯†ç 

![alt text](./jenkins-img/5.png)

* `æ„å»ºç¯å¢ƒ`

![alt text](./jenkins-img/6.png)

* `Build Steps`

![alt text](./jenkins-img/7.png)
![alt text](./jenkins-img/8.png)

æ‰“åŒ…è„šæœ¬
```shell
export PM2_HOME=/root/.pm2 # è¿™å¥ç”¨æ¥ç¡®ä¿ pm2 ç”¨çš„æ˜¯å…¨å±€å®‰è£…çš„é‚£ä¸ªï¼Œè€Œä¸æ˜¯jenkinsç¯å¢ƒä¸‹çš„é‚£ä¸ª

pwd # æ£€æŸ¥å½“å‰æ‰€åœ¨ç›®å½•ï¼Œåº”è¯¥éƒ½æ˜¯åœ¨jenkinsç›®å½•ä¸‹

node -v # æ£€æŸ¥æ‰“åŒ…ç¯å¢ƒï¼ŒæŸ¥çœ‹ä¸€ä¸‹æœåŠ¡å™¨nodeç‰ˆæœ¬
npm -v # æ£€æŸ¥æ‰“åŒ…ç¯å¢ƒï¼ŒæŸ¥çœ‹ä¸€ä¸‹æœåŠ¡å™¨npmç‰ˆæœ¬

npm install # å®‰è£…ä¾èµ–

rm -rf /root/$ProjectName/* # ç§»é™¤ä¸Šä¸€ä¸ªç‰ˆæœ¬ /root/coder-hub-full/ æ–‡ä»¶å¤¹é‡Œæ‰€æœ‰çš„å†…å®¹
cp -rf ./* /root/$ProjectName/ # æŠŠjenkinsç›®å½•ä¸‹æœ€æ–°çš„å…¨éƒ¨æ–‡ä»¶ç§»åŠ¨åˆ° /root/coder-hub-full/ æ–‡ä»¶å¤¹

cd /root/$ProjectName/
pm2 delete $ProjectName
pm2 start $EntryFile --name $ProjectName # é‡å¯ Node.js æœåŠ¡æˆ–åˆæ¬¡éƒ¨ç½²æ—¶å¯åŠ¨æœåŠ¡

echo 'ğŸš€ éƒ¨ç½²å®Œæˆ ğŸš€'
```


